<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å«è™Ÿé¡¯ç¤ºå±</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .text-brick { color: #9E5A5A; }
        /* å«è™Ÿå‹•ç•« */
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .number-pop { animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="bg-stone-900 h-screen overflow-hidden text-stone-400 select-none">

<div id="app" class="h-full flex">

    <div class="w-[60%] h-full flex flex-col items-center justify-center border-r border-stone-800 relative">
        <div class="absolute top-10 text-stone-500 tracking-[0.5em] text-sm uppercase opacity-50">Current Call</div>
        <p class="text-2xl mb-4 font-light tracking-widest text-stone-500">æœ€æ–°å–é¤</p>
        
        <h1 :key="currentNumber" class="text-[15rem] leading-none font-bold serif text-brick number-pop" 
            style="text-shadow: 0 0 50px rgba(158,90,90,0.4);">
            {{ currentNumber || '--' }}
        </h1>
        
        <div class="mt-12">
            <span v-if="currentNumber" class="text-3xl text-stone-200 bg-white/10 px-10 py-4 rounded-full backdrop-blur-md animate-pulse">
                è«‹è‡³æ«ƒå°å–é¤
            </span>
            <span v-else class="text-2xl text-stone-600 tracking-wider">
                ç¾å‘³æº–å‚™ä¸­...
            </span>
        </div>
    </div>

    <div class="w-[40%] h-full bg-stone-900 flex flex-col">
        <div class="p-6 bg-stone-800 border-b border-stone-700 shadow-md z-10">
            <h2 class="text-3xl font-bold text-white tracking-wider flex items-center gap-3">
                <span class="material-icons-round text-brick">restaurant_menu</span> å–é¤å€
            </h2>
            <p class="text-sm text-stone-400 mt-2">Ready for Pickup</p>
        </div>

        <div class="flex-1 overflow-y-auto p-6 content-start grid grid-cols-1 gap-4">
            <div v-for="order in recentDoneOrders" :key="order.key" 
                class="bg-stone-800/50 border border-stone-700 rounded-xl p-4 flex items-center justify-between animate-[fadeIn_0.5s_ease-out]">
                <span class="text-5xl font-bold text-stone-200 serif">#{{ order.number }}</span>
                <span class="text-xs text-stone-500 bg-stone-900 px-2 py-1 rounded">{{ order.timeString }}</span>
            </div>
            
            <div v-if="recentDoneOrders.length === 0" class="text-center text-stone-600 mt-20">
                <p>ç›®å‰ç„¡å¾…å–é¤è™Ÿç¢¼</p>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 w-[60%] bg-brick/10 py-2">
        <p class="text-stone-500 text-sm text-center">ç¾é»ç¾åšï¼Œè«‹è€å¿ƒç­‰å€™ ğŸ¥£</p>
    </div>

</div>

<script type="module">
    import { createApp, ref, computed, onMounted } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref as dbRef, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCrXoKUHMvQ8LMr_YuaQYTWEdLfWFYeLYY",
        authDomain: "jiantou-000rlhad.firebaseapp.com",
        databaseURL: "https://jiantou-000rlhad-default-rtdb.firebaseio.com",
        projectId: "jiantou-000rlhad",
        storageBucket: "jiantou-000rlhad.firebasestorage.app",
        messagingSenderId: "435285773521",
        appId: "1:435285773521:web:d6ce66a7d35bf3bbd049f0"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    createApp({
        setup() {
            const currentNumber = ref(null);
            const doneOrders = ref([]);

            onMounted(() => {
                // 1. ç›£è½æœ€æ–°å«è™Ÿ
                const callRef = dbRef(db, 'currentCallingNumber');
                onValue(callRef, (snapshot) => {
                    currentNumber.value = snapshot.val();
                });

                // 2. ç›£è½æ‰€æœ‰è¨‚å–®ï¼Œç¯©é¸å‡ºã€Œä»Šå¤©ã€ä¸”ã€Œå·²å®Œæˆã€çš„
                const ordersRef = dbRef(db, 'orders');
                onValue(ordersRef, (snapshot) => {
                    const data = snapshot.val();
                    const now = new Date();
                    const todayStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')}`;
                    
                    const list = [];
                    if (data) {
                        Object.keys(data).forEach(key => {
                            const order = data[key];
                            // ç¯©é¸æ¢ä»¶ï¼šä»Šå¤©çš„å–® + ç‹€æ…‹æ˜¯ done
                            if (order.dateString === todayStr && order.status === 'done') {
                                list.push({ ...order, key: key });
                            }
                        });
                    }
                    // æ’åºï¼šæœ€æ–°çš„æ™‚é–“åœ¨ä¸Šé¢
                    // é€™è£¡ç°¡å–®ç”¨ key (Firebase key å…¶å¯¦æ˜¯æŒ‰æ™‚é–“æ’åºçš„) åè½‰å³å¯
                    doneOrders.value = list.reverse();
                });
            });

            // ğŸŒŸ éæ¿¾åˆ—è¡¨ï¼šæŠŠã€Œæ­£åœ¨å¤§è¢å¹•é¡¯ç¤ºã€çš„é‚£å€‹è™Ÿç¢¼ï¼Œå¾å³é‚Šåˆ—è¡¨ä¸­æ‹¿æ‰ (é¿å…é‡è¤‡)
            const recentDoneOrders = computed(() => {
                return doneOrders.value.filter(o => o.number != currentNumber.value);
            });

            return { currentNumber, recentDoneOrders };
        }
    }).mount('#app');
</script>
</body>
</html>